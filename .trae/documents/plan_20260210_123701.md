# Rencana Perbaikan Error Database Stock Opname (Generated Column)

Berdasarkan investigasi, error `428C9` terjadi karena aplikasi mencoba memasukkan nilai (walaupun `null`) ke kolom `difference` pada tabel `stock_opname_items`. Kolom ini didefinisikan sebagai `GENERATED ALWAYS AS ... STORED` di database, yang artinya nilainya dihitung otomatis oleh PostgreSQL dan tidak boleh diisi manual.

## Langkah-langkah Perbaikan:

### 1. Modifikasi Frontend (`StockOpnameForm.tsx`)
Saya akan mengedit file [StockOpnameForm.tsx](file:///c:/Users/Fakhrul/Documents/trae_projects/ERPLaborasi/src/pages/StockOpname/StockOpnameForm.tsx) untuk menghapus field `difference` dari objek payload yang dikirim ke Supabase.

**Kode saat ini (Error):**
```typescript
const opnameItems = products.map(p => ({
  session_id: session.id,
  product_id: p.id,
  system_stock: p.stock_quantity || 0,
  physical_stock: null, 
  difference: null // <--- Penyebab Error
}));
```

**Perbaikan:**
```typescript
const opnameItems = products.map(p => ({
  session_id: session.id,
  product_id: p.id,
  system_stock: p.stock_quantity || 0,
  physical_stock: null 
  // Field difference dihapus agar database yang menghitungnya
}));
```

### 2. Verifikasi Skema Database
Memastikan kembali bahwa kolom `difference` pada tabel `stock_opname_items` memang bertipe generated column (sudah terkonfirmasi dari file migrasi `20260210000011_stock_opname_tables.sql`).

### 3. Testing
Setelah perbaikan kode, saya akan memverifikasi bahwa proses pembuatan session baru tidak lagi melemparkan error database. Karena saya tidak dapat berinteraksi langsung dengan UI browser Anda, saya akan memastikan kode Typescript valid dan logic-nya sesuai dengan aturan PostgreSQL.

### 4. Dokumentasi
Saya akan menyertakan komentar pada kode yang diubah untuk menjelaskan bahwa kolom `difference` adalah generated column dan tidak boleh disertakan dalam operasi INSERT/UPDATE.
